{% extends "client/base.html" %}

{% block title %}Mes relevés — Electruc{% endblock %}

{% block client_content %}
  <h3 class="h5">Mes relevés</h3>

  <section class="border rounded-3 p-3 bg-light mb-4">
    <h4 class="h6">Encoder un nouveau relevé</h4>
    {% if last_validated %}
      <p class="text-muted mb-2">
        Dernier relevé validé : {{ last_validated.reading_date|date:"d/m/Y" }} — {{ last_validated.value_kwh }} kWh
      </p>
    {% endif %}
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary">Envoyer le relevé</button>
    </form>
  </section>

  {% if readings %}
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <thead>
          <tr>
            <th>Date</th>
            <th>Index (kWh)</th>
            <th>Statut</th>
            <th>Note</th>
          </tr>
        </thead>
        <tbody>
          {% for reading in readings %}
            <tr>
              <td>{{ reading.reading_date|date:"d/m/Y" }}</td>
              <td>{{ reading.value_kwh }}</td>
              <td>
                {% if reading.status == "submitted" %}
                  <span class="badge text-bg-warning">En cours de validation</span>
                {% elif reading.status == "validated" %}
                  <span class="badge text-bg-success">Validé</span>
                {% else %}
                  <span class="badge text-bg-danger">Refusé</span>
                {% endif %}
              </td>
              <td>{{ reading.note|default:"—" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p>Aucun relevé disponible pour le moment.</p>
  {% endif %}
{% endblock %}
